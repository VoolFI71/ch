<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PowerChess — Матч</title>
  <script>
    try {
      if (localStorage.getItem('theme') === 'dark') {
        document.documentElement.classList.add('dark');
        document.body.classList.add('dark');
      }
    } catch {}
  </script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>♔</text></svg>'>
  <link rel="stylesheet" href="/styles/variables.css">
  <link rel="stylesheet" href="/styles/common.css">
  <link rel="stylesheet" href="/styles/header.css">
  <link rel="stylesheet" href="/styles/games.css">
  <link rel="stylesheet" href="/styles/chess-board.css">
  <link rel="stylesheet" href="/styles/match.css">
</head>
<body>
  <!-- HEADER -->
  <header class="header">
    <div class="container">
      <div class="header-content">
        <a href="/" class="logo">
          <div class="logo-icon">
            <div class="chess-pattern"></div>
            <svg width="32" height="32" viewBox="0 0 24 24" fill="none">
              <defs>
                <linearGradient id="match-crown-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                  <stop offset="0%" stop-color="#ffd700" />
                  <stop offset="50%" stop-color="#ffffff" />
                  <stop offset="100%" stop-color="#ffd700" />
                </linearGradient>
              </defs>
              <rect x="3" y="16" width="18" height="3" fill="url(#match-crown-gradient)" stroke="#fff" stroke-width="0.5" rx="1.5"/>
              <path d="M4 16L3 6L6 11L12 3L18 11L21 6L20 16H4Z" fill="url(#match-crown-gradient)" stroke="#fff" stroke-width="1"/>
              <circle cx="12" cy="9" r="1.5" fill="#e11d48" stroke="#fff" stroke-width="0.5"/>
            </svg>
            <svg width="14" height="14" viewBox="0 0 12 12" fill="none">
              <path d="M7 1L3 7H5L4 11L8 5H6L7 1Z" fill="#ffd700" stroke="#fff" stroke-width="0.8"/>
            </svg>
          </div>
          <div>
            <div class="gradient-text">PowerChess</div>
            <div>♔ Шахматная академия</div>
          </div>
        </a>
        <nav class="nav">
          <a href="/games" class="nav-link active">Играть</a>
          <a href="/course" class="nav-link">Курсы</a>
          <a href="/couch" class="nav-link">Тренеры</a>
          <a href="#reviews" class="nav-link">Отзывы</a>
          <a href="#tournaments" class="nav-link">Турниры</a>
        </nav>
        <div class="header-actions">
          <div id="authButtons">
            <button class="btn-login" id="gamesLoginBtn">
              <i class="fas fa-sign-in-alt"></i>
              Войти
            </button>
            <button class="btn-register" id="gamesRegisterBtn">
              <i class="fas fa-user-plus"></i>
              Регистрация
            </button>
          </div>
          <div id="userActions">
            <div id="gamesUserInfo">
              <span></span>
            </div>
          </div>
          <button class="theme-toggle" id="themeToggleBtn" title="Переключить тему">
            <i class="fas fa-sun" id="themeIcon"></i>
          </button>
          <button class="mobile-menu-btn" id="mobileMenuBtn">
            <i class="fas fa-bars" id="menuIcon"></i>
          </button>
          <button class="btn btn-outline logout-btn" id="gamesLogoutBtn">
            <i class="fas fa-sign-out-alt"></i>
            Выйти
          </button>
        </div>
      </div>
      <!-- Mobile Menu -->
      <div class="mobile-menu" id="mobileMenu">
        <div>
          <a href="/games" class="nav-link mobile-nav-link">Играть</a>
          <a href="/course" class="nav-link mobile-nav-link">Курсы</a>
          <a href="/couch" class="nav-link mobile-nav-link">Тренеры</a>
          <a href="#reviews" class="nav-link mobile-nav-link">Отзывы</a>
          <a href="#tournaments" class="nav-link mobile-nav-link">Турниры</a>
          <hr>
          <div id="mobileAuthButtons">
            <button class="btn-login" id="gamesLoginBtnMobile">
              <i class="fas fa-sign-in-alt"></i>
              Войти
            </button>
            <button class="btn-register" id="gamesRegisterBtnMobile">
              <i class="fas fa-user-plus"></i>
              Регистрация
            </button>
          </div>
          <div id="mobileUserActions">
            <div id="gamesUserInfoMobile">
              <span></span>
            </div>
            <button class="btn btn-outline logout-btn" id="gamesLogoutBtnMobile">
              <i class="fas fa-sign-out-alt"></i>
              Выйти
            </button>
          </div>
        </div>
      </div>
    </div>
  </header>

  <main class="match-main">
    <div class="container match-grid">
      <div class="match-left">
        <div id="matchMessage" class="empty-state hidden">
          Партия не найдена или недоступна.
        </div>

        <div class="board-card">
          <div class="board-container">
            <div class="board-wrapper">
              <div class="board-shell">
                <div class="chess-board" id="matchBoard"></div>
              </div>
            </div>
          </div>

          <div class="board-controls">
            <button class="control-btn" id="flipBoardBtn" title="Повернуть доску">
              <i class="fas fa-sync-alt"></i>
            </button>
            <button class="control-btn" id="exportPgnBtn" title="Экспортировать PGN">
              <i class="fas fa-download"></i> PGN
            </button>
            <div class="board-size-control">
              <button class="size-btn" id="decreaseSize" title="Уменьшить">
                <i class="fas fa-minus"></i>
              </button>
              <button class="size-btn" id="increaseSize" title="Увеличить">
                <i class="fas fa-plus"></i>
              </button>
            </div>
          </div>
        </div>
      </div>

      <div class="match-right">
        <section class="status-card">
          <div class="status-row">
            <div class="status-label">Контроль</div>
            <div class="status-value" id="gameTimeControl">—</div>
          </div>
          <div class="status-row">
            <div class="status-label">Статус</div>
            <span class="pill" id="gameStatusBadge">—</span>
          </div>
          <div class="status-row">
            <div class="status-label">Результат</div>
            <div class="status-value" id="gameResult">—</div>
          </div>
          <div class="status-row">
            <div class="status-label">Победитель</div>
            <div class="status-value" id="gameWinner">—</div>
          </div>
        </section>

        <section class="player-stack">
          <div class="player-bar top">
            <div class="player-info">
              <div class="player-label" id="topPlayerColor">—</div>
              <div class="player-name" id="topPlayerLabel">—</div>
            </div>
            <div class="player-clock" id="topClock">05:00</div>
          </div>
          <div class="player-bar bottom">
            <div class="player-info">
              <div class="player-label" id="bottomPlayerColor">—</div>
              <div class="player-name" id="bottomPlayerLabel">—</div>
            </div>
            <div class="player-clock" id="bottomClock">05:00</div>
          </div>
        </section>

        <section class="moves-card">
          <div class="card-header">
            <h3>Ходы</h3>
            <small>Кликните, чтобы увидеть позицию</small>
          </div>
          <ol class="moves-list" id="movesList"></ol>
        </section>

        <section class="actions-card" id="gameActions"></section>
      </div>
    </div>
  </main>

  <div id="gamesToast" class="toast"></div>

  <!-- Common Auth Script (must load first) -->
  <script src="/scripts/auth.js"></script>
  <!-- Match Page Scripts -->
  <script src="/scripts/chess-move-utils.js" defer></script>
  <script src="/scripts/chess-pieces-svg.js" defer></script>
  <script src="/scripts/match.state.js" defer></script>
  <script src="/scripts/match.api.js" defer></script>
  <script src="/scripts/match.js" defer></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const themeToggleBtn = document.getElementById('themeToggleBtn');
      if (themeToggleBtn) {
        themeToggleBtn.addEventListener('click', function(e) {
          e.preventDefault();
          if (window.toggleTheme) {
            window.toggleTheme();
          } else {
            const isDark = document.body.classList.contains('dark');
            document.body.classList.toggle('dark', !isDark);
            document.documentElement.classList.toggle('dark', !isDark);
            const icon = document.getElementById('themeIcon');
            if (icon) icon.className = !isDark ? 'fas fa-moon' : 'fas fa-sun';
            localStorage.setItem('theme', !isDark ? 'dark' : 'light');
          }
        });
      }
      
      const mobileMenuBtn = document.getElementById('mobileMenuBtn');
      if (mobileMenuBtn) {
        mobileMenuBtn.addEventListener('click', function() {
          if (typeof window.toggleMobileMenu === 'function') {
            window.toggleMobileMenu();
          }
        });
      }
      
      document.querySelectorAll('.mobile-nav-link').forEach(function(link) {
        link.addEventListener('click', function() {
          if (typeof window.closeMobileMenu === 'function') {
            window.closeMobileMenu();
          }
        });
      });
    });
  </script>
</body>
</html>

  